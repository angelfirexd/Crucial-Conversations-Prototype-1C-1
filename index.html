<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crucial Conversation Trainer (V22)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            min-height: 95vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .progress-container {
            background: #f0f0f0;
            padding: 15px 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .turn-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ddd;
            transition: all 0.3s ease;
        }

        .turn-dot.active {
            background: #667eea;
            transform: scale(1.3);
        }

        .turn-dot.completed {
            background: #4caf50;
        }

        #mainContent {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
        }

        .avatar-section {
            padding: 20px 20px 10px 20px;
            text-align: center;
            background: #f8f9fa;
        }

        .avatar {
            font-size: 4em;
            margin-bottom: 10px;
        }

        .speaker-name {
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .dialogue-bubble {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin: 10px 0;
            font-size: 1em;
            line-height: 1.5;
            text-align: left;
        }

        .prev-dialogue-bubble {
            background: #e3f2fd;
            border-radius: 15px;
            padding: 10px 15px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 10px;
            font-size: 0.85em;
            opacity: 0.8;
            text-align: left;
        }

        .content-section {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .instruction-text {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 0.95em;
            font-weight: 500;
        }

        .choices-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .choice-card {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .choice-card:active {
            transform: scale(0.98);
        }

        .choice-card.cooperative {
            border-color: #4caf50;
        }

        .choice-card.cooperative:hover {
            background: #e8f5e9;
            border-color: #388e3c;
        }

        .choice-card.neutral {
            border-color: #2196f3;
        }

        .choice-card.neutral:hover {
            background: #e3f2fd;
            border-color: #1976d2;
        }

        .choice-card.defensive {
            border-color: #ff9800;
        }

        .choice-card.resistant {
            border-color: #f44336;
        }

        .choice-card.defensive:hover {
            background: #fff3e0;
            border-color: #f57c00;
        }

        .choice-card.resistant:hover {
            background: #ffebee;
            border-color: #c62828;
        }

        .choice-label {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .label-cooperative {
            background: #4caf50;
            color: white;
        }

        .label-neutral {
            background: #2196f3;
            color: white;
        }

        .label-defensive {
            background: #ff9800;
            color: white;
        }

        .label-resistant {
            background: #f44336;
            color: white;
        }

        .choice-text {
            font-size: 0.95em;
            line-height: 1.4;
            color: #333;
        }

        .outcome-screen {
            text-align: center;
            padding: 20px;
        }

        .outcome-emoji {
            font-size: 5em;
            margin-bottom: 15px;
        }

        .outcome-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .outcome-description {
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 10px;
            color: #555;
        }

        .outcome-box {
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            text-align: left;
        }

        .outcome-winwin {
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%);
            color: white;
        }

        .outcome-compromise {
            background: linear-gradient(135deg, #ffc107 0%, #ffeb3b 100%);
            color: #333;
        }

        .outcome-neutral {
            background: linear-gradient(135deg, #2196f3 0%, #03a9f4 100%);
            color: white;
        }

        .outcome-tense {
            background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);
            color: white;
        }

        .outcome-breakdown {
            background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);
            color: white;
        }

        .reset-btn {
            margin-top: 20px;
            padding: 15px 30px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .reset-btn:active {
            transform: scale(0.95);
        }

        .path-badge {
            display: inline-block;
            padding: 5px 12px;
            background: #667eea;
            color: white;
            border-radius: 15px;
            margin: 3px;
            font-size: 0.8em;
        }

        .metrics {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.9em;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>üó£Ô∏è Crucial Conversations</h1>
            <p>Return-to-Office Discussion</p>
        </div>

        <div class="progress-container">
            <div class="turn-dot" id="dot1"></div>
            <div class="turn-dot" id="dot2"></div>
            <div class="turn-dot" id="dot3"></div>
            <div class="turn-dot" id="dot4"></div>
            <div class="turn-dot" id="dot5"></div>
            <div class="turn-dot" id="dot6"></div>
            <div class="turn-dot" id="dot7"></div>
        </div>

        <div id="mainContent"></div>
    </div>

    <script>
        const conversations = {
            // --- TURN 1 (MANAGER) ---
            start: {
                type: 'manager',
                turn: 1,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
            dialogue:
                    "Hi Alex, I need to discuss with you the new return-to-office mandate from corporate. It says everyone needs to be back in the office full-time by January 5th.",
                instruction: 'How do you approach this conversation?',
                choices: [
                    {
                        id: 'm1_coop',
                        label: 'COOPERATIVE',
                        type: 'cooperative',
                        text: "Before we get into logistics, I wanted to check in with you first. I know this is a big change, and what I really want is a solution that works for you and the team. I'd like to hear your thoughts so we can figure out a path forward together.",
                        next: 'state_e2_from_coop'
                    },
                    {
                        id: 'm1_neu',
                        label: 'NEUTRAL',
                        type: 'neutral',
                        text: "This is the official directive, and I'm letting everyone know. I also want to understand how this impacts you. What are your thoughts or concerns?",
                        next: 'state_e2_from_neutral'
                    },
                    {
                        id: 'm1_res',
                        label: 'RESISTANT',
                        type: 'resistant',
                        text: "Look, our team's remote performance has been stagnant, and I'm under pressure to get our Q4 numbers up. I need everyone back in-person to hit our targets, no exceptions.",
                        next: 'state_e2_from_selfish'
                    }
                ]
            },

            // --- TURN 2 (EMPLOYEE) FROM COOPERATIVE ---
            state_e2_from_coop: {
                type: 'employee',
                turn: 2,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    "Jamie: ...I know this is a big change, and what I really want is a solution that works for you and the team. I'd like to hear your thoughts so we can figure out a path forward together.",
                dialogue: null,
                instruction: 'Jamie was open and cooperative. How do you respond?',
                choices: [
                    {
                        id: 'e2_coop',
                        label: 'COOPERATIVE',
                        type: 'cooperative',
                        text: "Thanks for opening this up, Jamie. I appreciate you wanting to work through it together. To be honest, this is going to be very challenging for me. I've moved about an hour away, I have a new puppy, and I take night classes near my apartment, so a full-time return feels hard to manage.",
                        next: 'state_m3_positive'
                    },
                    {
                        id: 'e2_neu',
                        label: 'NEUTRAL',
                        type: 'neutral',
                        text: "That's going to be difficult. I live an hour away now and have other commitments outside of work. What flexibility, if any, is there in this policy?",
                        next: 'state_m3_positive'
                    },
                    {
                        id: 'e2_def',
                        label: 'DEFENSIVE',
                        type: 'defensive',
                        text: "I don't understand. My deliverables are all on time, and I've been hitting my goals. Why is corporate doing this when I'm clearly productive from home?",
                        next: 'state_m3_tense'
                    }
                ]
            },

            // --- TURN 2 (EMPLOYEE) FROM NEUTRAL ---
            state_e2_from_neutral: {
                type: 'employee',
                turn: 2,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    "Jamie: ...This is the official directive, and I'm letting everyone know. I also want to understand how this impacts you. What are your thoughts or concerns?",
                dialogue: null,
                instruction: 'Jamie was neutral and stated the fact. How do you respond?',
                choices: [
                    {
                        id: 'e2_coop',
                        label: 'COOPERATIVE',
                        type: 'cooperative',
                        text: "I appreciate you letting me know and asking. I need to be transparent: I've built my life around remote work. I moved, enrolled in night classes, and got a puppy. A full-time return would really disrupt all of that.",
                        next: 'state_m3_positive'
                    },
                    {
                        id: 'e2_neu',
                        label: 'NEUTRAL',
                        type: 'neutral',
                        text: "That's a problem for me. I don't live near the office anymore and have a long commute. What are my options in a situation like this?",
                        next: 'state_m3_neutral'
                    },
                    {
                        id: 'e2_res',
                        label: 'RESISTANT',
                        type: 'defensive',
                        text: "I can't do that. I work efficiently from home, and my deliverables prove it. This mandate doesn't make sense for someone in my situation.",
                        next: 'state_m3_tense'
                    }
                ]
            },

            // --- TURN 2 (EMPLOYEE) FROM RESISTANT MANAGER ---
            state_e2_from_selfish: {
                type: 'employee',
                turn: 2,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    "Jamie: ...our team's remote performance has been stagnant, and I'm under pressure to get our Q4 numbers up. I need everyone back in-person to hit our targets, no exceptions.",
                dialogue: null,
                instruction:
                    'Jamie was pressuring and blamed your performance. How do you respond?',
                choices: [
                    {
                        id: 'e2_def_coop',
                        label: 'DEFENSIVE BUT OPEN',
                        type: 'defensive',
                        text: "Hold on, Jamie. My performance has been solid, and I have the deliverables to prove it. This feels unfair, especially since I've moved and have commitments that depend on remote work. I want to find a way through this, but I need you to understand my situation.",
                        next: 'state_m3_conflict'
                    },
                    {
                        id: 'e2_def_neu',
                        label: 'NEUTRAL/FIRM',
                        type: 'neutral',
                        text: "I understand you're focused on targets, but I live in another city, have a puppy, and I'm in night school. Coming back full-time would force me to choose between my job and my education, which is a big ask.",
                        next: 'state_m3_conflict'
                    },
                    {
                        id: 'e2_def_res',
                        label: 'RESISTANT',
                        type: 'resistant',
                        text: "This is unreasonable. You're saying our performance is bad, but I've been delivering everything on time. I can't just uproot my entire life because corporate wants us in seats.",
                        next: 'state_m3_conflict'
                    }
                ]
            },

            // --- TURN 3 (MANAGER) POSITIVE PATH ---
            state_m3_positive: {
                type: 'manager',
                turn: 3,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
                prevDialogue:
                    "Alex: ...it's going to be very challenging for me. I've moved, I have a puppy, and I take night classes.",
                dialogue:
                    'Okay, thanks for sharing that. I really appreciate your honesty.',
                instruction:
                    'Alex shared his constraints openly. How do you acknowledge this?',
                choices: [
                    {
                        id: 'm3_coop',
                        label: 'COOPERATIVE',
                        type: 'cooperative',
                        text: "You're one of my best performers, and I really don't want to lose you. What I want is a plan that works for you and for the team‚Äôs goals. Can you walk me through your specific weekly schedule so we can see what options might work?",
                        next: 'state_e4_positive'
                    },
                    {
                        id: 'm3_neu',
                        label: 'NEUTRAL',
                        type: 'neutral',
                        text: "I understand that's challenging. Let me check with HR first to see what the official flexibility is. In the meantime, can you send me your recent performance metrics so I have them ready to support any request?",
                        next: 'state_e4_neutral'
                    }
                ]
            },

            // --- TURN 3 (MANAGER) NEUTRAL PATH ---
            state_m3_neutral: {
                type: 'manager',
                turn: 3,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
                prevDialogue:
                    "Alex: ...I don't live near the office anymore... What are my options?",
                dialogue: 'Right, a long commute is a real problem.',
                instruction: 'Both sides have been neutral. How do you proceed?',
                choices: [
                    {
                        id: 'm3_coop_neu',
                        label: 'OPENS UP',
                        type: 'cooperative',
                        text: "Okay, let's talk specifics. To find a solution that works, I need to understand your situation better. What are the biggest blockers for you right now?",
                        next: 'state_e4_positive'
                    },
                    {
                        id: 'm3_neu_neu',
                        label: 'STAYS NEUTRAL',
                        type: 'neutral',
                        text: "Understood. I'll check with HR about the official policy on exceptions and what pathways are available, then circle back.",
                        next: 'state_e4_neutral'
                    },
                    {
                        id: 'm3_dir_neu',
                        label: 'BECOMES DIRECTIVE',
                        type: 'resistant',
                        text: "I understand it's a problem, but this is the mandate. We all need to adapt. I need you to start planning for your return.",
                        next: 'state_e4_tense'
                    }
                ]
            },

            // --- TURN 3 (MANAGER) TENSE PATH ---
            state_m3_tense: {
                type: 'manager',
                turn: 3,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
                prevDialogue:
                    "Alex: ...My deliverables are all on time... Why is corporate doing this when I'm productive?",
                dialogue: 'I hear your frustration.',
                instruction:
                    "Alex is resistant, citing his performance. The conversation is tense. How do you respond?",
                choices: [
                    {
                        id: 'm3_coop_ten',
                        label: 'MAINTAINS SAFETY',
                        type: 'cooperative',
                        text: "You're right, your individual work is strong. I'm not questioning your productivity at all. This is coming from above me, and I'm caught in the middle of that pressure. My real goal is to keep you on the team and find something workable. Can we try to look at options together?",
                        next: 'state_e4_tense_recovery'
                    },
                    {
                        id: 'm3_def_ten',
                        label: 'BECOMES DEFENSIVE',
                        type: 'defensive',
                        text: 'Look, individual performance is one thing, but overall team metrics have dropped. I need everyone aligned to turn things around. That\'s the reality we\'re in.',
                        next: 'state_e4_tense'
                    },
                    {
                        id: 'm3_dir_ten',
                        label: 'BECOMES FIRM',
                        type: 'resistant',
                        text: "This isn't up for debate. The question is how we make it work, not whether we comply. I need your commitment.",
                        next: 'state_e4_tense'
                    }
                ]
            },

            // --- TURN 3 (MANAGER) CONFLICT PATH ---
            state_m3_conflict: {
                type: 'manager',
                turn: 3,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
                prevDialogue:
                    'Alex: ...My performance has been solid... This feels unfair...',
                dialogue: "You're right about your performance.",
                instruction:
                    'You started aggressively, and Alex is now defensive. How do you salvage this?',
                choices: [
                    {
                        id: 'm3_coop_con',
                        label: 'SOFTENS & APOLOGIZES',
                        type: 'cooperative',
                        text: "You're right ‚Äì I came on too strong. Your performance is solid, and I apologize for the way I framed that. I'm under a lot of pressure to get our numbers up, but that's not an excuse to dismiss your situation. Let's reset: what would you need to make this work?",
                        next: 'state_e4_tense_recovery'
                    },
                    {
                        id: 'm3_def_con',
                        label: 'STAYS FIRM',
                        type: 'defensive',
                        text: "I appreciate your work, but individual performance doesn't change the corporate mandate. Everyone has challenges. What's your plan to adapt to this?",
                        next: 'state_e4_tense'
                    },
                    {
                        id: 'm3_dir_con',
                        label: 'DOUBLES DOWN',
                        type: 'resistant',
                        text: "If your education and personal life are more important than this job, that's your choice. I can't make exceptions when everyone else is complying.",
                        next: 'state_e4_conflict'
                    }
                ]
            },

            // --- TURN 4 (EMPLOYEE) POSITIVE PATH ---
            state_e4_positive: {
                type: 'employee',
                turn: 4,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    'Jamie: ...Can you walk me through your specific weekly schedule so we can see what options might work?',
                dialogue: null,
                instruction:
                    'Jamie is asking for details to find a solution. What do you share?',
                choices: [
                    {
                        id: 'e4_details',
                        label: 'SHARE DETAILS',
                        type: 'cooperative',
                        text: 'Okay, thank you for asking. My main constraints are my night classes on Mondays and Wednesdays, which are near my home. The 1-hour commute would make them almost impossible to attend. I also need to arrange reliable dog care if I\'m away all day.',
                        next: 'state_m5_positive'
                    }
                ]
            },

            // --- TURN 4 (EMPLOYEE) NEUTRAL PATH ---
            state_e4_neutral: {
                type: 'employee',
                turn: 4,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    'Jamie: ...Let me check with HR first to see what the official flexibility is. In the meantime, can you send me your recent performance metrics so I have them ready to support any request?',
                dialogue: null,
                instruction:
                    'Jamie is going to check with HR, which delays the decision.',
                choices: [
                    {
                        id: 'e4_comply',
                        label: 'COMPLY',
                        type: 'neutral',
                        text: "Okay, I appreciate you checking. I'll send you my performance metrics right now. When do you think you'll have an update? The uncertainty is difficult for me.",
                        next: 'state_m5_neutral'
                    },
                    {
                        id: 'e4_push',
                        label: 'PUSH BACK',
                        type: 'defensive',
                        text: "I can send the metrics, but I'm worried this will just get lost in HR. I was hoping we could at least outline a potential solution now. What are you able to do directly as my manager?",
                        next: 'state_m5_neutral'
                    }
                ]
            },

            // --- TURN 4 (EMPLOYEE) TENSE PATH ---
            state_e4_tense: {
                type: 'employee',
                turn: 4,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    "Jamie: ...overall team metrics have dropped... I need everyone aligned to turn things around. That's the reality.",
                dialogue: null,
                instruction:
                    "Jamie is being firm or defensive. This isn't going well.",
                choices: [
                    {
                        id: 'e4_comply_tense',
                        label: 'COMPLY (TENSE)',
                        type: 'defensive',
                        text: "Fine. If there's no choice, I guess I'll have to figure it out. I'll be there, but I need it on record that this will likely force me to drop my classes.",
                        next: 'state_m5_tense'
                    },
                    {
                        id: 'e4_escalate',
                        label: 'ESCALATE',
                        type: 'resistant',
                        text: "If you're not willing to discuss this, then I need to speak with HR. This mandate doesn't account for individual performance or personal situations.",
                        next: 'state_m5_conflict'
                    }
                ]
            },

            // --- TURN 4 (EMPLOYEE) TENSE RECOVERY ---
            state_e4_tense_recovery: {
                type: 'employee',
                turn: 4,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    'Jamie: ...I apologize for coming on too strong... Let\'s reset: what would you need to make this work?',
                dialogue: null,
                instruction:
                    'Jamie apologized and is trying to de-escalate. How do you respond?',
                choices: [
                    {
                        id: 'e4_accept',
                        label: 'ACCEPT APOLOGY',
                        type: 'cooperative',
                        text: 'I appreciate you saying that. Thank you. Okay, let\'s start over. My main issue is my night class schedule on Mondays and Wednesdays and the long commute. I am open to a hybrid solution if we can avoid those class days.',
                        next: 'state_m5_positive'
                    }
                ]
            },

            // --- TURN 4 (EMPLOYEE) CONFLICT PATH ---
            state_e4_conflict: {
                type: 'employee',
                turn: 4,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    "Jamie: If your education and personal life are more important than this job, that's your choice.",
                dialogue: null,
                instruction:
                    "Jamie doubled down and implied your job isn't your priority. This is a direct conflict.",
                choices: [
                    {
                        id: 'e4_warn',
                        label: 'WARN MANAGER',
                        type: 'resistant',
                        text: "That is incredibly unprofessional. My personal life doesn't stop me from being a top performer. This is a hostile way to manage. I will be escalating this to HR.",
                        next: 'state_m5_conflict'
                    }
                ]
            },

            // --- TURN 5 (MANAGER) POSITIVE PATH ---
            state_m5_positive: {
                type: 'manager',
                turn: 5,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
                prevDialogue:
                    'Alex: ...my night classes on Mondays and Wednesdays... and the long commute...',
                dialogue:
                    "Thank you, that's exactly the kind of clarity I needed. It really helps me see a path.",
                instruction:
                    'Alex shared his specific constraints. What is your proposal?',
                choices: [
                    {
                        id: 'm5_propose_hybrid',
                        label: 'PROPOSE HYBRID',
                        type: 'cooperative',
                        text: 'Given your classes, what if we propose a 2-day hybrid model? You could come in on Tuesdays and Thursdays. That avoids your class days and still gets you in-office for key collaboration. From my side, that would support our team goals and help make this sustainable for you.',
                        next: 'state_e6_positive'
                    }
                ]
            },

            // --- TURN 5 (MANAGER) NEUTRAL PATH ---
            state_m5_neutral: {
                type: 'manager',
                turn: 5,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
                prevDialogue:
                    "Alex: ...When do you think you'll have an update? The uncertainty is difficult for me.",
                dialogue:
                    "You're right to want clarity. I don't want to leave you hanging.",
                instruction:
                    'Alex is waiting for an HR update. How do you respond to their concern about uncertainty?',
                choices: [
                    {
                        id: 'm5_timeline',
                        label: 'SET TIMELINE',
                        type: 'cooperative',
                        text: "I will speak to HR this afternoon and will send you an update by EOD tomorrow, even if it's just a status check. I'll advocate for a flexible solution, since your metrics clearly support it.",
                        next: 'state_e6_neutral'
                    },
                    {
                        id: 'm5_vague',
                        label: 'BE VAGUE',
                        type: 'neutral',
                        text: "I understand your frustration, but this is the process. I'll get back to you when I have a concrete answer from them.",
                        next: 'state_e6_neutral'
                    }
                ]
            },

            // --- TURN 5 (MANAGER) TENSE PATH ---
            state_m5_tense: {
                type: 'manager',
                turn: 5,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
                prevDialogue:
                    "Alex: Fine. If there's no choice, I guess I'll have to figure it out. I'll be there, but I need it on record that this will likely force me to drop my classes.",
                dialogue: 'I hear that this is a really heavy trade-off for you.',
                instruction:
                    'Alex has agreed to comply, but is clearly unhappy and resentful.',
                choices: [
                    {
                        id: 'm5_acknowledge',
                        label: 'ACKNOWLEDGE & PIVOT',
                        type: 'neutral',
                        text: "I've noted your concerns and the impact on your classes. I do appreciate your commitment to comply. Let's set up time next week to plan the transition and see if we can at least mitigate some of the impact on your schedule.",
                        next: 'state_e6_tense'
                    },
                    {
                        id: 'm5_ignore',
                        label: 'IGNORE & END',
                        type: 'resistant',
                        text: "Glad we're on the same page. I'll see you on Jan 2nd. Let's move on to your deliverables for next week...",
                        next: 'state_e6_conflict'
                    }
                ]
            },

            // --- TURN 5 (MANAGER) CONFLICT PATH ---
            state_m5_conflict: {
                type: 'manager',
                turn: 5,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
                prevDialogue:
                    'Alex: That is incredibly unprofessional... I will be escalating this to HR.',
                dialogue: 'This conversation is clearly off the rails.',
                instruction:
                    'Alex is escalating to HR. This is the final step before a total breakdown.',
                choices: [
                    {
                        id: 'm5_deescalate',
                        label: 'DE-ESCALATE (LAST CHANCE)',
                        type: 'cooperative',
                        text: "Hold on, let's not involve HR yet if we can avoid it. That wasn't my intent, and I apologize for how I came across. My frustration with our team numbers boiled over, but that‚Äôs on me. Let's try to find a solution here. A 2-day hybrid model is on the table. Can we talk about whether that would work for you?",
                        next: 'state_e6_tense_recovery'
                    },
                    {
                        id: 'm5_threaten',
                        label: 'STAND FIRM / THREATEN',
                        type: 'resistant',
                        text: 'You can go to HR if you want, but they will tell you the same thing. This is the policy. Escalating this instead of finding a solution is a poor career move.',
                        next: 'state_e6_conflict'
                    }
                ]
            },

            // --- TURN 6 (EMPLOYEE) POSITIVE PATH ---
            state_e6_positive: {
                type: 'employee',
                turn: 6,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    'Jamie: ...what if we propose a 2-day hybrid model? You could come in on Tuesdays and Thursdays...',
                dialogue: null,
                instruction:
                    'Jamie proposed a 2-day hybrid (Tues/Thurs) that respects your constraints. How do you respond?',
                choices: [
                    {
                        id: 'e6_accept',
                        label: 'ACCEPT PROPOSAL',
                        type: 'cooperative',
                        text: 'Yes, that would work well. Tuesdays and Thursdays in-office is a solution I can absolutely commit to. That way I can still manage my classes and my puppy. Thank you for working with me on this.',
                        next: 'state_m7_positive'
                    }
                ]
            },

            // --- TURN 6 (EMPLOYEE) NEUTRAL PATH ---
            state_e6_neutral: {
                type: 'employee',
                turn: 6,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    'Jamie: ...I will speak to HR this afternoon and will send you an update by EOD tomorrow...',
                dialogue: null,
                instruction:
                    'The manager has given you a timeline (or been vague) about the HR check.',
                choices: [
                    {
                        id: 'e6_wait',
                        label: 'WAIT (UNCERTAIN)',
                        type: 'neutral',
                        text: 'Okay, thank you. I\'ll look for your update tomorrow. I really hope we can find a solution that works for both sides.',
                        next: 'state_m7_neutral'
                    }
                ]
            },

            // --- TURN 6 (EMPLOYEE) TENSE PATH ---
            state_e6_tense: {
                type: 'employee',
                turn: 6,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    'Jamie: ...Let\'s set up time next week to plan the transition and see if we can mitigate the impact...',
                dialogue: null,
                instruction:
                    'Jamie acknowledged your frustration and wants to "mitigate" the impact, but the decision is made.',
                choices: [
                    {
                        id: 'e6_tense_accept',
                        label: 'ACCEPT (TENSE)',
                        type: 'defensive',
                        text: "Fine. We can meet, but my core issues remain. I'll be there, but I'm not happy about it.",
                        next: 'state_m7_tense'
                    }
                ]
            },

            // --- TURN 6 (EMPLOYEE) TENSE RECOVERY ---
            state_e6_tense_recovery: {
                type: 'employee',
                turn: 6,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    'Jamie: ...That wasn\'t my intent, and I apologize... A 2-day hybrid model is on the table. Can we talk about whether that would work for you?',
                dialogue: null,
                instruction:
                    'Jamie backpedaled from the HR threat and offered a 2-day hybrid. This is a possible recovery.',
                choices: [
                    {
                        id: 'e6_accept_recovery',
                        label: 'ACCEPT (CAUTIOUS)',
                        type: 'cooperative',
                        text: "...Okay. I'll pause on going to HR. A 2-day hybrid is what I was hoping for. If we can agree on Tuesdays and Thursdays, then I think we have a solution.",
                        next: 'state_m7_positive'
                    }
                ]
            },

            // --- TURN 6 (EMPLOYEE) CONFLICT PATH ---
            state_e6_conflict: {
                type: 'employee',
                turn: 6,
                avatar: 'üë§',
                speaker: 'Alex (Employee)',
                prevDialogue:
                    'Jamie: ...Escalating this instead of finding a solution is a poor career move.',
                dialogue: null,
                instruction:
                    'Jamie ignored your feelings or threatened you about going to HR. The relationship is broken.',
                choices: [
                    {
                        id: 'e6_resign',
                        label: 'RESIGN',
                        type: 'resistant',
                        text: 'I cannot work for someone who manages this way. This is toxic. Please accept this as my formal resignation.',
                        next: 'state_m7_conflict'
                    }
                ]
            },

            // --- TURN 7 (MANAGER) POSITIVE PATH ---
            state_m7_positive: {
                type: 'manager',
                turn: 7,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
                prevDialogue:
                    'Alex: Yes, that would work well. Tuesdays and Thursdays in-office is a solution I can absolutely commit to.',
                dialogue:
                    "That's fantastic. I'm really glad we found a solution that works for you and the team.",
                instruction:
                    'Alex has agreed to the hybrid model. How do you lock in this win?',
                choices: [
                    {
                        id: 'm7_winwin',
                        label: 'COOPERATIVE',
                        type: 'cooperative',
                        text: "Tuesdays and Thursdays are locked in. I'll email HR to document this as an approved flexible arrangement so it's on record. This feels like a great result for everyone. Thank you for working through it with me.",
                        next: 'outcome_winwin'
                    },
                    {
                        id: 'm7_neutral',
                        label: 'NEUTRAL',
                        type: 'neutral',
                        text: 'Good. Tuesdays and Thursdays are the plan. I\'ll let HR know so it\'s documented. To make sure our performance numbers stay strong, please send me a brief weekly status report on your in-office work.',
                        next: 'outcome_winwin_neutral'
                    }
                ]
            },

            // --- TURN 7 (MANAGER) NEUTRAL PATH ---
            state_m7_neutral: {
                type: 'manager',
                turn: 7,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
                prevDialogue:
                    "Alex: Okay, thank you. I'll look for your update tomorrow. I really hope we can find a solution that works for both sides.",
                dialogue: 'You will hear from me.',
                instruction:
                    "You've told Alex you will get back to them. How do you end the conversation?",
                choices: [
                    {
                        id: 'm7_workable',
                        label: 'FINALIZE (WORKABLE)',
                        type: 'cooperative',
                        text: "Great. I'll be in touch by EOD tomorrow with the next steps from HR, even if it's just an interim update. Talk soon.",
                        next: 'outcome_workable'
                    },
                    {
                        id: 'm7_neutral',
                        label: 'FINALIZE (NEUTRAL)',
                        type: 'neutral',
                        text: "Okay, I'll let you know what I hear from HR when they respond.",
                        next: 'outcome_neutral'
                    }
                ]
            },

            // --- TURN 7 (MANAGER) TENSE PATH ---
            state_m7_tense: {
                type: 'manager',
                turn: 7,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
                prevDialogue:
                    "Alex: Fine. We can meet, but my core issues remain. I'll be there, but I'm not happy about it.",
                dialogue: 'I understand.',
                instruction:
                    'You are ending a tense conversation where the employee is complying but is resentful.',
                choices: [
                    {
                        id: 'm7_tense',
                        label: 'FINALIZE (TENSE)',
                        type: 'neutral',
                        text: "Okay. My calendar invite is sent for next week. We'll talk then.",
                        next: 'outcome_tense'
                    }
                ]
            },

            // --- TURN 7 (MANAGER) CONFLICT PATH ---
            state_m7_conflict: {
                type: 'manager',
                turn: 7,
                avatar: 'üëî',
                speaker: 'Jamie (Manager)',
                prevDialogue:
                    'Alex: I cannot work for someone who manages this way. This is toxic. Please accept this as my formal resignation.',
                dialogue: "Well, I'm sorry you feel that way.",
                instruction: 'Alex has resigned due to the conflict.',
                choices: [
                    {
                        id: 'm7_breakdown',
                        label: 'ACCEPT RESIGNATION',
                        type: 'resistant',
                        text: 'I am sorry it came to this. I accept your resignation. HR will be in touch regarding your exit process.',
                        next: 'outcome_breakdown'
                    }
                ]
            },

            // --- OUTCOMES ---
            outcome_winwin: {
                type: 'outcome',
                emoji: 'üéâ',
                title: 'Win-Win Solution',
                outcomeClass: 'outcome-winwin',
                description:
                    "Both parties collaborated to find a creative solution that respects everyone's needs and maintains trust.",
                result:
                    "Manager: \"Tuesdays and Thursdays are locked in. This is a great result. Thank you for working through it with me.\"\n\nEmployee: \"That's perfect. I can manage my classes and be present for the team.\"\n\n‚úÖ Hybrid arrangement approved\n‚úÖ Both needs met\n‚úÖ Relationship strengthened",
                metrics: { trust: 95, satisfaction: 95, retention: 98 }
            },

            outcome_winwin_neutral: {
                type: 'outcome',
                emoji: 'ü§ù',
                title: 'Win-Win (Neutral)',
                outcomeClass: 'outcome-winwin',
                description:
                    'A solution was found, but the manager remains focused on performance metrics more than the relationship.',
                result:
                    "Manager: \"Good. Tuesdays and Thursdays are the plan. Please send me a weekly status report...\"\n\nEmployee: \"Okay, I can do that. Thank you.\"\n\n‚úÖ Hybrid arrangement approved\n‚úÖ Needs are met, but transactionally\n‚úÖ Relationship is professional, not strengthened",
                metrics: { trust: 80, satisfaction: 80, retention: 90 }
            },

            outcome_workable: {
                type: 'outcome',
                emoji: 'ü§î',
                title: 'Workable but Uncertain',
                outcomeClass: 'outcome-compromise',
                description:
                    'A clear timeline was set for a decision, which builds some trust but leaves the final outcome open.',
                result:
                    "Manager: \"I will get back to you by EOD tomorrow.\"\n\nEmployee: \"Okay, thank you. I'll wait for your update.\"\n\n‚úÖ Clear timeline set\n‚ö†Ô∏è Decision delayed\n‚úÖ Door still open for dialogue",
                metrics: { trust: 70, satisfaction: 65, retention: 75 }
            },

            outcome_neutral: {
                type: 'outcome',
                emoji: '‚è≥',
                title: 'Neutral Outcome',
                outcomeClass: 'outcome-neutral',
                description:
                    'The manager was vague, leaving the employee in a state of uncertainty and mild frustration.',
                result:
                    "Manager: \"I'll let you know what I hear from HR.\"\n\nEmployee: \"Okay...\"\n\n‚úÖ No direct conflict created\n‚ö†Ô∏è Uncertainty remains\n‚ùå Employee may start looking for other options",
                metrics: { trust: 50, satisfaction: 45, retention: 55 }
            },

            outcome_tense: {
                type: 'outcome',
                emoji: 'üò∞',
                title: 'Tense Compliance',
                outcomeClass: 'outcome-tense',
                description:
                    'The employee complies with the mandate, but the relationship is badly damaged and trust is low.',
                result:
                    "Employee: \"Fine. I'll be there, but I'm not happy about it.\"\n\nManager: \"Okay. We'll meet next week to discuss it.\"\n\n‚ö†Ô∏è Employee complies but is resentful\n‚ùå Trust damaged\n‚ùå High risk of turnover",
                metrics: { trust: 35, satisfaction: 30, retention: 40 }
            },

            outcome_breakdown: {
                type: 'outcome',
                emoji: 'üíî',
                title: 'Relationship Breakdown',
                outcomeClass: 'outcome-breakdown',
                description:
                    'The conversation failed, leading to the employee\'s resignation and a significant loss for the team.',
                result:
                    "Employee: \"I cannot work for you. I resign.\"\n\nManager: \"I accept your resignation.\"\n\n‚ùå Complete trust breakdown\n‚ùå Valuable employee lost\n‚ùå Negative impact on team morale",
                metrics: { trust: 10, satisfaction: 5, retention: 5 }
            }
        };

        let currentState = 'start';
        let pathHistory = [];
        let turnNumber = 1;

        function updateProgress(turn) {
            for (let i = 1; i <= 7; i++) {
                const dot = document.getElementById(`dot${i}`);
                if (!dot) continue;
                if (i < turn) {
                    dot.className = 'turn-dot completed';
                } else if (i === turn) {
                    dot.className = 'turn-dot active';
                } else {
                    dot.className = 'turn-dot';
                }
            }
        }

        function renderConversation(stateId) {
            const state = conversations[stateId];
            if (!state) {
                console.error('State not found:', stateId);
                return;
            }

            const container = document.getElementById('mainContent');
            if (!container) {
                console.error('Main content container not found!');
                return;
            }

            if (state.type === 'outcome') {
                renderOutcome(state);
                return;
            }

            turnNumber = state.turn;

            const html = `
                <div class="avatar-section">
                    <div class="avatar">${state.avatar}</div>
                    <div class="speaker-name">${state.speaker}</div>
                    ${state.prevDialogue ? `<div class="prev-dialogue-bubble">${state.prevDialogue}</div>` : ''}
                    ${state.dialogue ? `<div class="dialogue-bubble">${state.dialogue}</div>` : ''}
                </div>

                <div class="content-section">
                    <div class="instruction-text">${state.instruction}</div>
                    <div class="choices-grid">
                        ${state.choices
                            .map(
                                choice => `
                            <div class="choice-card ${choice.type}" 
                                 data-next="${choice.next}"
                                 data-label="${choice.label}">
                                <span class="choice-label label-${choice.type}">${choice.label}</span>
                                <div class="choice-text">${choice.text}</div>
                            </div>
                        `
                            )
                            .join('')}
                    </div>
                </div>
            `;

            container.innerHTML = html;
            updateProgress(turnNumber);
            attachChoiceHandlers();
        }

        function attachChoiceHandlers() {
            const cards = document.querySelectorAll('.choice-card');
            cards.forEach(card => {
                card.addEventListener('click', () => {
                    const nextState = card.dataset.next;
                    const label = card.dataset.label;
                    makeChoice(nextState, label);
                });
            });
        }

        function renderOutcome(state) {
            const container = document.getElementById('mainContent');
            if (!container) return;

            const html = `
                <div class="outcome-screen">
                    <div class="outcome-emoji">${state.emoji}</div>
                    <div class="outcome-title">${state.title}</div>
                    <div class="outcome-description">${state.description}</div>

                    <div class="outcome-box ${state.outcomeClass}">
                        ${state.result
                            .split('\n')
                            .map(line =>
                                line ? `<p style="margin:8px 0;">${line}</p>` : '<br>'
                            )
                            .join('')}
                    </div>

                    <div class="metrics">
                        <div class="metric-item">
                            <span><strong>Trust Level:</strong></span>
                            <span>${state.metrics.trust}%</span>
                        </div>
                        <div class="metric-item">
                            <span><strong>Employee Satisfaction:</strong></span>
                            <span>${state.metrics.satisfaction}%</span>
                        </div>
                        <div class="metric-item">
                            <span><strong>Retention Likelihood:</strong></span>
                            <span>${state.metrics.retention}%</span>
                        </div>
                    </div>

                    <div style="margin-top:20px;">
                        <strong>Your conversation path:</strong><br>
                        ${pathHistory
                            .map(step => `<span class="path-badge">${step}</span>`)
                            .join('')}
                    </div>

                    <button class="reset-btn" id="resetBtn">Try Again</button>
                </div>
            `;

            container.innerHTML = html;
            updateProgress(7);

            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', resetConversation);
            }
        }

        function makeChoice(nextState, label) {
            pathHistory.push(label);
            currentState = nextState;
            renderConversation(nextState);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function resetConversation() {
            currentState = 'start';
            pathHistory = [];
            turnNumber = 1;
            renderConversation('start');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function initConversation() {
            currentState = 'start';
            pathHistory = [];
            turnNumber = 1;
            renderConversation('start');
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initConversation);
        } else {
            initConversation();
        }
    </script>
</body>
</html>
